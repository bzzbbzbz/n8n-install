# üìä –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ /stats –∏ /top

## –û–±–∑–æ—Ä –∑–∞–¥–∞—á–∏

–†–∞–∑–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–º–∞–Ω–¥—É `/stats` –Ω–∞ –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- `/stats` ‚Äî –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
- `/top` ‚Äî —Ä–µ–π—Ç–∏–Ω–≥ —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ –≥—Ä—É–ø–ø—ã

---

## 1. –ö–æ–º–∞–Ω–¥–∞ `/stats` (–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

### 1.1. –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```
/stats           ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
/stats @username ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
```

### 1.2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö** –∏–∑ `allowed_chat_ids`
- –í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (–∫–∞–∫ —Å–µ–π—á–∞—Å)

### 1.3. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –§–æ—Ä–º–∞—Ç |
|------|----------|--------|
| üí∞ –ë–∞–ª–∞–Ω—Å | –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å | `üí∞ –ë–∞–ª–∞–Ω—Å: 150 –æ—á–∫–æ–≤` |
| üîê –°–µ–π—Ñ | –ë–∞–ª–∞–Ω—Å —Å–µ–π—Ñ–∞ | `üîê –í —Å–µ–π—Ñ–µ: 50 –æ—á–∫–æ–≤` |
| üèÜ –ü–æ–∑–∏—Ü–∏—è | –ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –≥—Ä—É–ø–ø—ã | `üèÜ –ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: #5` |
| üé∞ –°–ª–æ—Ç—ã | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–ª–æ—Ç–∞–º | —Å–º. –Ω–∏–∂–µ |
| ‚öîÔ∏è –î—É—ç–ª–∏ | PvP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | —Å–º. –Ω–∏–∂–µ |
| üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤ | `üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤: 3` |
| üí∏ –î–æ–ª–≥–∏ | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–ª–≥–∞—Ö | —Å–º. –Ω–∏–∂–µ |

#### –§–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–ª–æ—Ç–æ–≤ (–µ—Å–ª–∏ games > 0):
```
üé∞ –°–ª–æ—Ç—ã:
   –í—Å–µ–≥–æ –∏–≥—Ä: 334
   üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 6667 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 8765 | WR: 43.2%
```

#### –§–æ—Ä–º–∞—Ç PvP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥—É—ç–ª–∏):
```
‚öîÔ∏è –î—É—ç–ª–∏: 15W / 8L / 2D
```

#### –§–æ—Ä–º–∞—Ç –¥–æ–ª–≥–æ–≤:
```
üí∏ –î–æ–ª–∂–µ–Ω:
   ‚Ä¢ 50 –æ—á–∫–æ–≤ ‚Üí @creditor1
   ‚Ä¢ 30 –æ—á–∫–æ–≤ ‚Üí @creditor2

üí∞ –¢–µ–±–µ –¥–æ–ª–∂–Ω—ã:
   ‚Ä¢ 25 –æ—á–∫–æ–≤ ‚Üê @debtor1
```

### 1.4. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

#### –°–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`/stats`)

```python
@router.message(Command("stats"))
async def cmd_stats(message, command, db):
    if message.chat.type not in ("group", "supergroup"):
        return "–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö."
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    if not command.args:
        user_id = message.from_user.id
        return await format_user_stats(db, user_id, message.chat.id)
    
    # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω @username ‚Äî –∏—â–µ–º –∏–≥—Ä–æ–∫–∞
    username = parse_username(command.args)
    if not username:
        return "‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /stats –∏–ª–∏ /stats @username"
    
    user = await db.get_user_by_nickname(username)
    if not user:
        return f"‚ùå –ò–≥—Ä–æ–∫ @{username} –Ω–µ –Ω–∞–π–¥–µ–Ω"
    
    return await format_user_stats(db, user['user_id'], message.chat.id)
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ

–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ `db.py`:

```python
async def get_user_rank_in_group(self, user_id: int, chat_id: int) -> int | None:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –≥—Ä—É–ø–ø—ã (1-based).
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç None –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≥—Ä—É–ø–ø–µ.
    """
    query = """
    SELECT rank FROM (
        SELECT 
            u.user_id,
            ROW_NUMBER() OVER (ORDER BY u.balance DESC) as rank
        FROM users u
        JOIN user_groups ug ON u.user_id = ug.user_id
        WHERE ug.chat_id = ?
    ) WHERE user_id = ?
    """
    ...
```

### 1.5. –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ zeroemps

üí∞ –ë–∞–ª–∞–Ω—Å: 150 –æ—á–∫–æ–≤
üîê –í —Å–µ–π—Ñ–µ: 50 –æ—á–∫–æ–≤
üèÜ –ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: #5

üé∞ –°–ª–æ—Ç—ã:
   –í—Å–µ–≥–æ –∏–≥—Ä: 334
   üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 6667 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 8765 | WR: 43.2%

‚öîÔ∏è –î—É—ç–ª–∏: 15W / 8L / 2D

üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤: 3

üí∏ –î–æ–ª–∂–µ–Ω:
   ‚Ä¢ 50 –æ—á–∫–æ–≤ ‚Üí @creditor1
```

### 1.6. Throttling

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `throttling_key: "default"` (1 —Å–µ–∫—É–Ω–¥–∞).

---

## 2. –ö–æ–º–∞–Ω–¥–∞ `/top` (–†–µ–π—Ç–∏–Ω–≥ –≥—Ä—É–ø–ø—ã)

### 2.1. –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```
/top ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ –≥—Ä—É–ø–ø—ã
```

### 2.2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö** –∏–∑ `allowed_chat_ids`
- –í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

### 2.3. –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

```
üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ —á–∞—Ç–∞ Group Name:

1. ü•á player1 ‚Äî 500 –æ—á–∫–æ–≤
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 1200
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 15000 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 14500 | WR: 51.2%
      ‚öîÔ∏è –î—É—ç–ª–∏: 25W / 10L / 5D
      üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤: 2

2. ü•à player2 ‚Äî 450 –æ—á–∫–æ–≤ (–¥–æ–ª–∂–µ–Ω: 30 @player1)
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 800
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 9000 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 8600 | WR: 48.5%

...

10. player10 ‚Äî 50 –æ—á–∫–æ–≤
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 100
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 1200 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 1250 | WR: 42.0%

---
25. üë§ –¢—ã: zeroemps ‚Äî 15 –æ—á–∫–æ–≤
```

### 2.4. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

```python
@router.message(Command("top"), flags={"throttling_key": "top"})
async def cmd_top(message, db):
    if message.chat.type not in ("group", "supergroup"):
        return "–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö."
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ø-10
    top_users = await db.get_top_users_in_group(message.chat.id, limit=10)
    
    if not top_users:
        return "–í —ç—Ç–æ–º —á–∞—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤."
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
    text = format_top_list(top_users, message.chat.title)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–æ—à—ë–ª –ª–∏ –≤—ã–∑—ã–≤–∞—é—â–∏–π –≤ —Ç–æ–ø-10
    user_id = message.from_user.id
    user_in_top = any(u['user_id'] == user_id for u in top_users)
    
    if not user_in_top:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞, –µ—Å–ª–∏ –æ–Ω –Ω–µ –≤ —Ç–æ–ø–µ
        user_rank = await db.get_user_rank_in_group(user_id, message.chat.id)
        if user_rank:
            user_data = await db.get_user(user_id)
            nickname = user_data.get('nickname', '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π')
            balance = user_data.get('balance', 0)
            text += f"\n---\n{user_rank}. üë§ –¢—ã: {nickname} ‚Äî {balance} –æ—á–∫–æ–≤"
    
    return text
```

### 2.5. –ú–µ–¥–∞–ª–∏ –¥–ª—è —Ç–æ–ø-3

| –ü–æ–∑–∏—Ü–∏—è | –≠–º–æ–¥–∑–∏ |
|---------|--------|
| 1 | ü•á |
| 2 | ü•à |
| 3 | ü•â |
| 4-10 | –±–µ–∑ —ç–º–æ–¥–∑–∏ |

### 2.6. Throttling

**–û—Ç–¥–µ–ª—å–Ω—ã–π throttling_key** —Å cooldown **5 —Å–µ–∫—É–Ω–¥**:

–í `middlewares/throttling.py` –¥–æ–±–∞–≤–∏—Ç—å:
```python
THROTTLE_TIMES = {
    "spin": 2,
    "default": 1,
    "top": 5,  # <-- –Ω–æ–≤—ã–π –∫–ª—é—á
}
```

### 2.7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –≤ `event_history`:

| event_type | –û–ø–∏—Å–∞–Ω–∏–µ | amount | metadata |
|------------|----------|--------|----------|
| `view_top` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–π—Ç–∏–Ω–≥–∞ | 0 | `{"chat_id": ...}` |

---

## 3. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ë–î

### 3.1. –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ `db.py`

```python
async def get_user_rank_in_group(self, user_id: int, chat_id: int) -> int | None:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –≥—Ä—É–ø–ø—ã (1-based)."""
    pass

async def get_debts_by_creditor(self, creditor_id: int, chat_id: int) -> list[dict]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–ª–≥–æ–≤, –≥–¥–µ –∏–≥—Ä–æ–∫ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–µ–¥–∏—Ç–æ—Ä–æ–º (–µ–º—É –¥–æ–ª–∂–Ω—ã)."""
    pass
```

### 3.2. –ù–æ–≤—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

| event_type | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `view_stats` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å–≤–æ–µ–π –∏–ª–∏ —á—É–∂–æ–π) |
| `view_top` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–π—Ç–∏–Ω–≥–∞ –≥—Ä—É–ø–ø—ã |

---

## 4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ handlers

### 4.1. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π): –î–æ–±–∞–≤–∏—Ç—å –æ–±–µ –∫–æ–º–∞–Ω–¥—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `group_games.py`

–í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `stats.py` –¥–ª—è `/stats` –∏ `/top`

### 4.2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞

–ï—Å–ª–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π —Ñ–∞–π–ª:
```python
# bot/__main__.py
from bot.handlers import stats
dp.include_router(stats.router)
```

---

## 5. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

–¢–µ–∫—É—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/stats` –≤ `group_games.py` (—Å—Ç—Ä–æ–∫–∏ ~39-99) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
2. –†–µ–π—Ç–∏–Ω–≥ –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤ –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É `/top`

---

## 6. –¢–µ—Å—Ç-–∫–µ–π—Å—ã

### 6.1. –ö–æ–º–∞–Ω–¥–∞ `/stats`

| –°—Ü–µ–Ω–∞—Ä–∏–π | –í–≤–æ–¥ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|------|---------------------|
| –°–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | `/stats` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ |
| –ß—É–∂–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | `/stats @player1` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É player1 |
| –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–≥—Ä–æ–∫ | `/stats @unknown` | "–ò–≥—Ä–æ–∫ @unknown –Ω–µ –Ω–∞–π–¥–µ–Ω" |
| –í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö | `/stats` | "–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö" |
| –ë–µ–∑ –¥–æ–ª–≥–æ–≤ | `/stats` | –°–µ–∫—Ü–∏—è –¥–æ–ª–≥–æ–≤ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è |
| –° –¥–æ–ª–≥–∞–º–∏ | `/stats` | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ª–≥–∏ –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã |

### 6.2. –ö–æ–º–∞–Ω–¥–∞ `/top`

| –°—Ü–µ–Ω–∞—Ä–∏–π | –í–≤–æ–¥ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|------|---------------------|
| –ï—Å—Ç—å –∏–≥—Ä–æ–∫–∏ | `/top` | –¢–æ–ø-10 —Å –º–µ–¥–∞–ª—è–º–∏ –¥–ª—è —Ç–æ–ø-3 |
| –ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ | `/top` | "–í —ç—Ç–æ–º —á–∞—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤" |
| –í—ã–∑—ã–≤–∞—é—â–∏–π –≤ —Ç–æ–ø-10 | `/top` | –¢–æ–ø-10, –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ |
| –í—ã–∑—ã–≤–∞—é—â–∏–π –≤–Ω–µ —Ç–æ–ø–∞ | `/top` | –¢–æ–ø-10 + —Å—Ç—Ä–æ–∫–∞ —Å –ø–æ–∑–∏—Ü–∏–µ–π –∏–≥—Ä–æ–∫–∞ |
| –°–ø–∞–º (< 5 —Å–µ–∫) | `/top` `/top` | –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (throttle) |
| –í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö | `/top` | "–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö" |

---

## 7. –ú–∏–≥—Ä–∞—Ü–∏—è

### 7.1. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏–≤—ã–∫–ª–∏ –∫ `/stats` –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞. –í–∞—Ä–∏–∞–Ω—Ç—ã:
1. **–ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
2. **–° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚Äî –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ `/top` –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É

### 7.2. –ê–Ω–æ–Ω—Å –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `/stats` –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π –Ω–µ–¥–µ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
üí° –†–µ–π—Ç–∏–Ω–≥ –≥—Ä—É–ø–ø—ã —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∫–æ–º–∞–Ω–¥–µ /top
```

---

## 8. –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### 8.1. `/stats` (—Å–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ zeroemps

üí∞ –ë–∞–ª–∞–Ω—Å: 150 –æ—á–∫–æ–≤
üîê –í —Å–µ–π—Ñ–µ: 50 –æ—á–∫–æ–≤
üèÜ –ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: #5

üé∞ –°–ª–æ—Ç—ã:
   –í—Å–µ–≥–æ –∏–≥—Ä: 334
   üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 6667 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 8765 | WR: 43.2%

‚öîÔ∏è –î—É—ç–ª–∏: 15W / 8L / 2D

üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤: 3
```

### 8.2. `/stats @player` (—á—É–∂–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ player1

üí∞ –ë–∞–ª–∞–Ω—Å: 500 –æ—á–∫–æ–≤
üîê –í —Å–µ–π—Ñ–µ: 200 –æ—á–∫–æ–≤
üèÜ –ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ: #1

üé∞ –°–ª–æ—Ç—ã:
   –í—Å–µ–≥–æ –∏–≥—Ä: 1200
   üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 15000 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 14500 | WR: 51.2%

‚öîÔ∏è –î—É—ç–ª–∏: 25W / 10L / 5D

üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤: 2

üí∏ –î–æ–ª–∂–µ–Ω:
   ‚Ä¢ 30 –æ—á–∫–æ–≤ ‚Üí @player2

üí∞ –ï–º—É –¥–æ–ª–∂–Ω—ã:
   ‚Ä¢ 50 –æ—á–∫–æ–≤ ‚Üê @player3
   ‚Ä¢ 20 –æ—á–∫–æ–≤ ‚Üê @player4
```

### 8.3. `/top` (—Ä–µ–π—Ç–∏–Ω–≥)

```
üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ —á–∞—Ç–∞ Left4Dead Gang:

1. ü•á player1 ‚Äî 500 –æ—á–∫–æ–≤
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 1200
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 15000 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 14500 | WR: 51.2%
      ‚öîÔ∏è –î—É—ç–ª–∏: 25W / 10L / 5D
      üíÄ –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤: 2

2. ü•à player2 ‚Äî 450 –æ—á–∫–æ–≤ (–¥–æ–ª–∂–µ–Ω: 30 @player1)
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 800
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 9000 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 8600 | WR: 48.5%

3. ü•â player3 ‚Äî 400 –æ—á–∫–æ–≤
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 600
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 7500 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 7200 | WR: 50.1%
      ‚öîÔ∏è –î—É—ç–ª–∏: 18W / 12L / 3D

4. player4 ‚Äî 350 –æ—á–∫–æ–≤
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 500
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 6000 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 5800 | WR: 49.2%

...

10. player10 ‚Äî 50 –æ—á–∫–æ–≤
      üé∞ –í—Å–µ–≥–æ –∏–≥—Ä: 100
      üìà –í—ã–∏–≥—Ä–∞–Ω–æ: 1200 | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: 1250 | WR: 42.0%

---
25. üë§ –¢—ã: zeroemps ‚Äî 15 –æ—á–∫–æ–≤
```

---

## 9. –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_user_rank_in_group()` –≤ `db.py`
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_user_stats_in_group()` –≤ `db.py`
- [x] –ú–µ—Ç–æ–¥ `get_debts_owed_to()` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `db.py`
- [x] –î–æ–±–∞–≤–∏—Ç—å throttling key "top" —Å 5 —Å–µ–∫ cooldown –≤ `ThrottlingMiddleware`
- [x] –î–æ–±–∞–≤–∏—Ç—å `throttle_time_top` –≤ `GameConfig` (—Å –¥–µ—Ñ–æ–ª—Ç–æ–º 5)
- [x] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/stats` –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [x] –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `/top` –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ —Ç–æ–ø-10
- [x] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π `view_stats` –∏ `view_top`
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∞–ª–∏ ü•áü•àü•â –¥–ª—è —Ç–æ–ø-3 –≤ `/top`
- [x] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –≤ `/top`, –µ—Å–ª–∏ –æ–Ω –Ω–µ –≤ —Ç–æ–ø-10
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ –ø.6
